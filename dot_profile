#
# ~/.profile
#
if ! (declare -f -F pathmunge > /dev/null ); then
	pathmunge () {
		if (test -d "$1") && ! (echo $PATH | /bin/egrep -q "(^|:)$1($|:)") &> /dev/null; then
			if [ "$2" = "after" ] ; then
				PATH=$PATH:$1
			else
				PATH=$1:$PATH
			fi
		fi
	}
fi

fallback_commands () {
	for command in "$@"
	do
		if command -v $command &> /dev/null; then
			echo $command
			break
		fi
	done
}

command_exists () {
	command -v "$1" &> /dev/null
}

export EDITOR="$(fallback_commands nvim vim vi)"

# homebrew
if [ -d /opt/homebrew ]; then
	eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# rust
if [ -f $HOME/.cargo/env ]; then
	source "$HOME/.cargo/env"
fi

# deno
pathmunge $HOME/.deno/bin

# flutter
pathmunge $HOME/.local/share/flutter/bin

# gcloud sdk
pathmunge $HOME/.local/share/google-cloud-sdk/bin

# golang
pathmunge $HOME/go/bin
pathmunge $HOME/.local/share/go/bin
if command -v go &> /dev/null; then
	pathmunge "$(go env GOBIN)"
	pathmunge "$(go env GOPATH)/bin"
	export GO111MODULE=on
fi

# snapcraft
pathmunge /var/lib/snapd/snap/bin

# node
if command -v npm &> /dev/null; then
	pathmunge "$(npm get prefix)/bin"
fi
if command -v yarn &> /dev/null; then
	pathmunge "$(yarn config get prefix)/bin"
fi

# python
if command -v python3 &> /dev/null; then
	alias python=python3
	alias pip="python3 -m pip"
	pathmunge "$(python3 -m site --user-base)/bin"
fi

# ruby
if command -v ruby &> /dev/null && command -v gem &> /dev/null; then
	pathmunge "$(ruby -r rubygems -e 'puts Gem.user_dir')/bin"
fi

# java
if command_exists /usr/libexec/java_home; then
	export JAVA_VERSION=11
	export JAVA_HOME="$(/usr/libexec/java_home)"
	pathmunge "$JAVA_HOME/bin"
fi

